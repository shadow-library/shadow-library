{
  "$schema": "../../schema/collections.json",
  "name": "test-database-collections",
  "description": "Test database collections",
  "definitions": {
    "UserEmail": {
      "email": {
        "type": "string",
        "required": true,
        "format": "email",
        "transform": "lowercase"
      },
      "primary": {
        "type": "boolean"
      },
      "verified": {
        "type": "boolean",
        "required": true,
        "default": false
      }
    },
    "UserAuth": {
      "$discriminator": {
        "key": "type",
        "values": {
          "user-password-auth": {
            "password": {
              "type": "string",
              "required": true
            },
            "passwordResetToken": {
              "type": "string"
            }
          },
          "user-oauth": {
            "provider": {
              "type": "string",
              "required": true,
              "enum": ["google", "facebook"]
            },
            "spuid": {
              "type": "string",
              "required": true
            },
            "refreshToken": {
              "type": "string",
              "required": true
            }
          }
        }
      }
    },
    "UserSession": {
      "usid": {
        "type": "int",
        "required": true
      },
      "token": {
        "type": "string",
        "required": true
      },
      "ipAddr": {
        "type": "string",
        "format": "ipv4"
      },
      "userAgent": {
        "type": "string"
      },
      "accessedAt": {
        "type": "date",
        "required": true,
        "default": "now"
      },
      "createdAt": {
        "type": "date",
        "immutable": true,
        "default": "now"
      }
    },
    "UserProfile": {
      "firstName": {
        "type": "string",
        "required": true,
        "trim": true,
        "format": "person-name"
      },
      "lastName": {
        "type": "string",
        "trim": true,
        "format": "person-name"
      },
      "gender": {
        "type": "int",
        "enum": { "Male": 1, "Female": 2 }
      },
      "imageURL": {
        "type": "string",
        "format": "uri"
      },
      "dob": {
        "type": "string",
        "format": "date"
      },
      "createdAt": {
        "type": "date",
        "immutable": true,
        "default": "now"
      }
    }
  },
  "collections": [
    {
      "name": "Account",
      "schema": {
        "_id": {
          "type": "uniqueId",
          "alias": "aid"
        },
        "name": {
          "type": "string",
          "required": true,
          "trim": true
        },
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "type": {
          "type": "int",
          "enum": { "Personal": 0, "Organization": 1 }
        }
      },
      "indexes": [{ "keys": { "name": 1 }, "unique": true }]
    },
    {
      "name": "User",
      "schema": {
        "_id": {
          "type": "uniqueId",
          "alias": "uid"
        },
        "aid": {
          "type": "uniqueId",
          "required": true
        },
        "status": {
          "required": true,
          "type": "int",
          "enum": { "Inactive": 0, "Active": 1, "Closed": 2 }
        },
        "role": {
          "type": "int",
          "required": true,
          "enum": { "User": 0, "Admin": 1, "SuperAdmin": 2 }
        },
        "emails": {
          "type": "array",
          "subType": "UserEmail",
          "required": true
        },
        "profile": {
          "type": "object",
          "subType": "UserProfile",
          "required": true
        },
        "auth": {
          "type": "array",
          "subType": "UserAuth",
          "required": true
        },
        "sessions": {
          "type": "array",
          "subType": "UserSession",
          "required": true
        }
      },
      "indexes": [
        { "name": "UNIQUE_EMAIL_IDS", "keys": { "emails.email": 1 }, "unique": true },
        { "name": "INDEX_AID", "keys": { "aid": 1 } }
      ],
      "relations": [{ "collection": "Accounts", "localField": "aid", "foreignField": "aid" }],
      "projections": {
        "profile-auth": { "aid": true, "uid": true, "status": true, "role": true, "profile": true, "auth": true }
      }
    },
    {
      "name": "Blog",
      "createdAt": true,
      "updatedAt": true,
      "schema": {
        "_id": {
          "type": "uniqueId",
          "alias": "bid"
        },
        "aid": {
          "type": "uniqueId",
          "description": "Account ID, If provided blog is only visible to the users in this account"
        },
        "uid": {
          "type": "uniqueId",
          "required": true
        },
        "title": {
          "type": "string",
          "required": true,
          "trim": true,
          "validator": "^.{3,100}$"
        },
        "content": {
          "type": "string",
          "required": true,
          "trim": true,
          "validator": "^.{20,}$"
        },
        "tags": {
          "type": "array",
          "subType": "string",
          "required": true
        }
      },
      "indexes": [{ "keys": { "aid": 1, "createdAt": -1, "uid": 1 } }],
      "relations": [
        { "collection": "Users", "localField": "uid", "foreignField": "uid" },
        { "collection": "Accounts", "localField": "aid", "foreignField": "aid" }
      ]
    },
    {
      "name": "Comment",
      "createdAt": true,
      "schema": {
        "bid": {
          "type": "uniqueId",
          "required": true
        },
        "uid": {
          "type": "uniqueId",
          "required": true
        },
        "content": {
          "type": "string",
          "required": true,
          "trim": true,
          "validator": "^.{1,}$"
        }
      },
      "indexes": [{ "keys": { "bid": 1, "createdAt": -1 } }, { "keys": { "uid": 1, "createdAt": -1 } }],
      "relations": [
        { "collection": "Blogs", "localField": "bid", "foreignField": "bid" },
        { "collection": "Users", "localField": "uid", "foreignField": "uid" }
      ]
    }
  ]
}
